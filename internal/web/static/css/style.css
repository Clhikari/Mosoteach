@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

:root {
    /* Layout Variables */
    --sidebar-width: 260px;
    --log-panel-width: 320px;
    --header-height: 60px;
    
    /* Fuwari/Pro Design Tokens */
    --radius-full: 999px;
    --radius-lg: 16px;
    --radius-md: 12px;
    --radius-sm: 8px;
    
    --transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

/* Dark Theme (Pro Dark) */
[data-theme="dark"] {
    --bg-app: #0f1115;        /* Deepest background */
    --bg-sidebar: #15171b;    /* Sidebar background */
    --bg-card: #1c1e23;       /* Card background */
    --bg-hover: #25282e;
    
    --border: #2a2d35;
    --border-light: rgba(255, 255, 255, 0.05);
    
    --primary: #7d5df6;       /* Vivid Purple */
    --primary-dim: rgba(125, 93, 246, 0.15);
    --primary-fg: #ffffff;
    
    --text-main: #e0e2e8;
    --text-muted: #8b92a5;
    
    --success: #2e9e62;
    --danger: #e04f5f;
    --warning: #e0b04f;
    
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.2);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.3);
}

/* Light Theme (Pro Light) */
[data-theme="light"] {
    --bg-app: #f2f4f7;
    --bg-sidebar: #ffffff;
    --bg-card: #ffffff;
    --bg-hover: #f0f2f5;
    
    --border: #e1e4e8;
    --border-light: rgba(0, 0, 0, 0.03);
    
    --primary: #6366f1;       /* Indigo */
    --primary-dim: rgba(99, 102, 241, 0.1);
    --primary-fg: #ffffff;
    
    --text-main: #1f2937;
    --text-muted: #6b7280;
    
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
}

/* Base Reset */
* { box-sizing: border-box; outline: none; }
html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; }
body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-app);
    color: var(--text-main);
    font-size: 14px;
    line-height: 1.5;
}

/* ---------------- Animations ---------------- */

@keyframes slideInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInRight {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes pulse-ring {
    0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(125, 93, 246, 0.7); }
    70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(125, 93, 246, 0); }
    100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(125, 93, 246, 0); }
}

@keyframes progress-stripe {
    0% { background-position: 1rem 0; }
    100% { background-position: 0 0; }
}

/* Staggered Animation Classes */
.sidebar { animation: slideInRight 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
.top-bar { animation: fadeIn 0.4s ease 0.1s backwards; }
.content-body { animation: slideInUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) 0.2s backwards; }

/* Micro-interactions */
.btn:active, .nav-item:active, .quiz-card:active {
    transform: scale(0.96);
}

/* App Layout Grid */
.app-layout {
    display: grid;
    grid-template-columns: var(--sidebar-width) 1fr;
    grid-template-rows: 100vh;
    height: 100vh;
}

/* ---------------- Sidebar ---------------- */
.sidebar {
    background-color: var(--bg-sidebar);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    padding: 20px;
    z-index: 10;
}

.sidebar-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 24px;
    padding: 0 8px;
}

.logo {
    font-weight: 800;
    font-size: 18px;
    background: linear-gradient(135deg, var(--primary), #a78bfa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.version {
    font-size: 10px;
    background: var(--bg-hover);
    padding: 2px 6px;
    border-radius: 4px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
}

.user-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
}

.avatar-placeholder {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, var(--primary), #818cf8);
    border-radius: var(--radius-full);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 16px;
}

.user-details { overflow: hidden; }
.user-name { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-status { font-size: 11px; color: var(--text-muted); display: flex; align-items: center; gap: 4px; }
.user-status::before { content: ''; width: 6px; height: 6px; background: var(--text-muted); border-radius: 50%; }
.user-status.online::before { background: var(--success); box-shadow: 0 0 8px var(--success); }

.nav-menu {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    border: none;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    transition: var(--transition);
    text-align: left;
    font-weight: 500;
}

.nav-item:hover { background: var(--bg-hover); color: var(--text-main); }
.nav-item.active { background: var(--primary-dim); color: var(--primary); }
.nav-icon { font-size: 16px; }

.sidebar-footer {
    border-top: 1px solid var(--border);
    padding-top: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.theme-toggle {
    background: var(--bg-hover);
    border: 1px solid var(--border);
    width: 32px; height: 32px;
    border-radius: var(--radius-full);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: var(--transition);
}
.theme-toggle:hover { border-color: var(--text-muted); }

.sse-status {
    font-size: 10px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--danger);
    background: rgba(224, 79, 95, 0.1);
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 6px;
}
.sse-status.connected { 
    color: var(--success); 
    background: rgba(46, 158, 98, 0.1); 
}
.sse-status.connected::before {
    content: '';
    width: 6px;
    height: 6px;
    background-color: var(--success);
    border-radius: 50%;
    animation: pulse-ring 2s infinite;
}

/* ---------------- Main Content ---------------- */
.main-content {
    background: var(--bg-app);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.top-bar {
    height: var(--header-height);
    border-bottom: 1px solid var(--border);
    background: var(--bg-app); /* Transparent feel */
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
}

.page-title { margin: 0; font-size: 18px; font-weight: 700; }

.content-body {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
}

/* View: Answer */
.view-answer {
    display: grid;
    grid-template-rows: auto 1fr;
    gap: 20px;
    height: 100%;
}

.control-panel {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 20px;
}

.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}
.panel-header h3 { margin: 0; font-size: 14px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }

.status-badge {
    font-size: 11px; padding: 2px 8px; border-radius: 10px;
    background: var(--bg-hover); color: var(--text-muted);
}
.status-badge.running { background: var(--primary); color: white; animation: pulse 2s infinite; }

.panel-actions { display: flex; gap: 12px; margin-bottom: 20px; }

.selected-quiz-hint {
    background: var(--primary-dim);
    color: var(--primary);
    padding: 10px 14px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}
.selected-quiz-hint::before { content: 'üéØ'; margin-right: 8px; }

.progress-block {
    background: var(--bg-hover);
    padding: 12px;
    border-radius: var(--radius-md);
}

/* States */
.empty-state, .loading-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
    font-size: 14px;
    font-style: italic;
    background: var(--bg-app);
    border-radius: var(--radius-md);
    border: 1px dashed var(--border);
    margin-top: 10px;
}

.loading-state::after {
    content: '...';
    animation: fadeIn 1s infinite;
}

.progress-labels { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; }
.progress-track { height: 6px; background: rgba(0,0,0,0.1); border-radius: 3px; overflow: hidden; }
.progress-bar { 
    height: 100%; 
    background: var(--primary); 
    width: 0; 
    transition: width 0.3s;
    background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
    background-size: 1rem 1rem;
    animation: progress-stripe 1s linear infinite;
}

.quiz-panel {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}
.quiz-panel .panel-header { padding: 16px 20px; border-bottom: 1px solid var(--border); margin: 0; }

.quiz-list-container {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}

.course-section { margin-bottom: 24px; }
.course-header {
    font-size: 12px; font-weight: 700; color: var(--text-muted);
    margin-bottom: 12px; padding-left: 8px; border-left: 3px solid var(--primary);
}

.quiz-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 12px;
}

.quiz-card {
    background: var(--bg-app);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative;
    overflow: hidden;
}
.quiz-card:hover { 
    transform: translateY(-4px) scale(1.02); 
    border-color: var(--primary); 
    box-shadow: var(--shadow-md); 
    background: var(--bg-card);
}
.quiz-card.selected { border-color: var(--primary); background: var(--primary-dim); }
.quiz-card.completed { opacity: 0.6; filter: grayscale(0.5); }

/* Stagger quiz cards */
.quiz-grid .quiz-card:nth-child(1) { animation: slideInUp 0.4s ease 0.1s backwards; }
.quiz-grid .quiz-card:nth-child(2) { animation: slideInUp 0.4s ease 0.15s backwards; }
.quiz-grid .quiz-card:nth-child(3) { animation: slideInUp 0.4s ease 0.2s backwards; }
.quiz-grid .quiz-card:nth-child(4) { animation: slideInUp 0.4s ease 0.25s backwards; }
.quiz-grid .quiz-card:nth-child(n+5) { animation: slideInUp 0.4s ease 0.3s backwards; }

.quiz-icon { font-size: 20px; transition: transform 0.3s; }
.quiz-card:hover .quiz-icon { transform: scale(1.2) rotate(10deg); }

.quiz-name { font-weight: 500; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px;}

/* View: Resources */
.resource-list { display: flex; flex-direction: column; gap: 16px; }
.resource-group { background: var(--bg-card); border-radius: var(--radius-lg); border: 1px solid var(--border); overflow: hidden; }
.resource-course-title { padding: 12px 16px; background: var(--bg-hover); font-weight: 600; font-size: 13px; }
.file-row {
    padding: 10px 16px; border-bottom: 1px solid var(--border-light);
    display: grid; grid-template-columns: 30px 1fr 80px 80px; align-items: center;
}
.file-row:last-child { border-bottom: none; }
.file-tag { font-size: 11px; padding: 2px 6px; border-radius: 4px; background: var(--bg-app); color: var(--text-muted); text-align: center; }
.file-tag.exp { color: var(--warning); background: rgba(245, 158, 11, 0.1); }

/* View: Models */
.models-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }

.model-edit-card { 
    background: var(--bg-card); 
    border: 1px solid var(--border); 
    border-radius: var(--radius-lg); 
    padding: 20px; 
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative;
    overflow: hidden;
}

.model-edit-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary);
}

/* Stagger model cards */
.models-grid .model-edit-card:nth-child(1) { animation: slideInUp 0.4s ease 0.1s backwards; }
.models-grid .model-edit-card:nth-child(2) { animation: slideInUp 0.4s ease 0.15s backwards; }
.models-grid .model-edit-card:nth-child(3) { animation: slideInUp 0.4s ease 0.2s backwards; }
.models-grid .model-edit-card:nth-child(n+4) { animation: slideInUp 0.4s ease 0.25s backwards; }

.model-top { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border-light); }
.switch { appearance: none; width: 32px; height: 18px; background: var(--border); border-radius: 20px; position: relative; cursor: pointer; transition: .3s; }
.switch:checked { background: var(--success); }
.switch::after { content:''; position: absolute; top:2px; left:2px; width:14px; height:14px; background:white; border-radius:50%; transition:.3s; }
.switch:checked::after { left:16px; }

.input-ghost { background: transparent; border: none; font-weight: 600; color: var(--text-main); flex: 1; font-size: 14px; }
.input-ghost:focus { color: var(--primary); }

.input-block { 
    width: 100%; 
    background: var(--bg-app); 
    border: 1px solid var(--border); 
    padding: 10px 12px; 
    border-radius: var(--radius-sm); 
    color: var(--text-main); 
    margin-bottom: 8px; 
    font-family: 'JetBrains Mono'; 
    font-size: 12px; 
    transition: var(--transition);
}
.input-block:focus { 
    border-color: var(--primary); 
    background: var(--bg-card); 
    box-shadow: 0 0 0 3px var(--primary-dim);
}

.test-result { margin-top: 12px; font-size: 11px; padding: 8px 12px; border-radius: var(--radius-sm); display: flex; align-items: center; gap: 6px; }
.test-result.success { background: rgba(16, 185, 129, 0.1); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.2); }
.test-result.error { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.2); }

.add-model-card {
    border: 2px dashed var(--border); 
    border-radius: var(--radius-lg);
    display: flex; align-items: center; justify-content: center;
    color: var(--text-muted); 
    cursor: pointer; 
    min-height: 200px;
    transition: var(--transition);
    background: rgba(0,0,0,0.02);
}
.add-model-card:hover { 
    border-color: var(--primary); 
    color: var(--primary); 
    background: var(--primary-dim);
    transform: scale(0.98);
}

/* View: Config */
.config-card { 
    background: var(--bg-card); 
    padding: 40px; 
    border-radius: var(--radius-lg); 
    border: 1px solid var(--border); 
    max-width: 500px; 
    margin: 40px auto; 
    box-shadow: var(--shadow-sm);
    animation: slideInUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
}
.config-card h3 {
    margin-top: 0;
    margin-bottom: 24px;
    font-size: 18px;
    color: var(--text-main);
    text-align: center;
}
.form-item { margin-bottom: 24px; }
.form-item label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-muted); font-size: 13px; }

/* View: Logs (Full Page) */
.view-logs {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.full-height-card {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
}

.full-height-card .panel-header {
    background: var(--bg-hover);
    border-bottom: 1px solid var(--border);
    padding: 16px 20px;
}

.log-full-container {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    color: var(--text-muted);
}

.log-line {
    margin-bottom: 8px;
    display: flex;
    gap: 12px;
    word-break: break-all;
    line-height: 1.6;
    border-bottom: 1px solid var(--border-light);
    padding-bottom: 4px;
}

.ts { color: var(--text-muted); opacity: 0.7; min-width: 85px; user-select: none; }
.msg { flex: 1; color: var(--text-main); }

.log-line.info .msg { color: var(--primary); }
.log-line.success .msg { color: var(--success); }
.log-line.error .msg { color: var(--danger); }

.log-placeholder {
    color: var(--text-muted);
    text-align: center;
    margin-top: 100px;
    font-style: italic;
    opacity: 0.5;
}

/* Hidden Side Log Panel */
.log-panel { display: none; }

/* Buttons */
.btn {
    padding: 8px 16px; border: none; border-radius: var(--radius-sm);
    font-weight: 600; cursor: pointer; transition: var(--transition);
    display: inline-flex; align-items: center; justify-content: center; gap: 6px;
}
.btn.primary { background: var(--primary); color: white; }
.btn.primary:hover { background: #5558dd; }
.btn.secondary { background: var(--bg-hover); color: var(--text-main); border: 1px solid var(--border); }
.btn.secondary:hover { border-color: var(--text-muted); }
.btn.danger { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
.btn.danger:hover { background: var(--danger); color: white; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }

.btn-icon { background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px; padding: 4px; border-radius: 4px; }
.btn-icon:hover { background: var(--bg-hover); color: var(--text-main); }
.btn-text { background: transparent; border: none; color: var(--primary); font-weight: 600; cursor: pointer; }

@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

/* Responsive */
@media (max-width: 1024px) {
    .app-layout {
        grid-template-columns: 240px 1fr;
    }
    .log-panel { display: none; /* Hide logs on tablets */ }
}

@media (max-width: 768px) {
    .app-layout { grid-template-columns: 1fr; }
    .sidebar { display: none; /* Mobile menu needed but hiding for now */ }
}

/* Toast ÊèêÁ§∫Ê†∑Âºè */
.toast {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 500;
    z-index: 9999;
    animation: toastIn 0.3s ease;
    box-shadow: var(--shadow-md);
}

.toast.success {
    background: var(--success);
    color: #fff;
}

.toast.error {
    background: var(--danger);
    color: #fff;
}

@keyframes toastIn {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}
